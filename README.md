# "Disease-economy trade-offs under alternative pandemic control strategies" replication package

This repository contains data, code, and images for the paper "Disease-economy trade-offs under alternative pandemic control strategies". The model output was generated in R 3.6.0, 3.6.3, and 4.0.1.

This repository is still being cleaned up and made into a turnkey experience; your patience is appreciated!


### How is this repository organized?

	* /Code contains all of the R code used to generate model results.

	* /Data contains the contact matrices.

	* /Figures contains all of the figures used in the paper and code used to generate figures.

### What does the code in /bin do?

Broadly, there are three types of code files: R files which describe functions and algorithms (e.g., "functions.R"), R scripts which implement various algorithms and calculations (e.g., "epicon_script.R"), and shell scripts which call the R scripts (e.g., "generate_figure_2_data.sh").

#### R codes

	* "epicon_script.R" is the main code which generates model output. Most other scripts either use this or its output. The default parameters are intended to be suitable for testing small-scale parameter variations. The model outputs used for figures were generated by passing script arguments through shell scripts. These shell scripts are described below.
		- "functions.R" contains functions used throughout the code. "dp_solver()" is the code for the main dynamic programming algorithm.

	* "calibrate_utility_parameters.R" is called by "epicon_script.R". It calibrates the utility function as described in Methods and SI. The default is to use analytical formulas for the static consumption-labor choices; an option for grid search is also available by setting the "numerical_calibration" flag on line 190 of epicon_script.R to 1.
		- This script outputs a set of csv files containing calibrated parameter values and measures of calibration accuracy.
		- "epicon_calibration_functions.R" and "functions.R" contain some functions and algorithms used here.

	* "contact_data_conversion.R" takes contact matrix data in /Data and calculates the appropriate mixing-adjusted average number of contacts for use as $\rho_c, \rho_l, \rho_o$ parameter values. These values are already coded in epicon_script.R; this script is included for reproducibility, but does not need to be re-run.

#### Data inputs

#### Model outputs

### How do I recreate the figures and data files? (IN PROGRESS)

The first step is to make sure R and the necessary R packages are installed. You can find a list of necessary packages in the header of /Code/epicon_script.R. Installing R should take 5-10 minutes; you can install R from [CRAN](https://cran.r-project.org/).

#### To generate the main model output, used in figures 2 and 3:

	* Run "generate_figure_2_data.sh".

	* Note that the number of cores is set to 80 by default; you will likely want to adjust this to match your computing equipment and time requirements. This code was run on a desktop computer running Ubuntu 20.04 with dual Intel Xeon Gold 6230 20C CPUs and 256 GB RAM, where it took roughly 5 hours. 
		- The memory requirement is relatively low, but the more cores the better. Each core requires an additional copy of the data, so will induce higher RAM use.

	* The header of the shell script describes the arguments to epicon_script.R.

#### To generate the model output used in figure 4 sensitivity analysis:

	* These were generated by running the Rscript calls in generate_figure_2_data.sh over a grid of values for the rho_c and rho_o arguments. The code was run on the BigRed3 system of the IU HPC cluster; detailed specifications can be found [here](https://kb.iu.edu/d/aoku).

	* Each point in the heatmap of the figures was generated using one node on the cluster. Each point took roughly 18-24 hours to compute.


